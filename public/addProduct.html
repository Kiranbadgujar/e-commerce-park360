<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <title>Admin Dashboard</title>
    <!-- Favicon-->
    <link rel="icon" type="image/x-icon" href="assets/favicon.ico" />
    <!-- Bootstrap icons-->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <!-- Core theme CSS (includes Bootstrap)-->
    <link href="css/styles.css" rel="stylesheet" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"
      integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />

    <style>
      #active {
        width: 100%;
        padding: 10px;
        font-size: 1rem;
        border: 1px solid #ccc;
        border-radius: 5px;
        background-color: #fff;
        transition: border-color 0.3s ease;
      }

      #active:focus {
        border-color: #007bff; /* Change border color when focused */
        outline: none;
      }

      #active option {
        padding: 10px;
        font-size: 1rem;
      }

      #active option:hover {
        background-color: #f0f0f0;
      }

      .col-lg-6 {
        margin-bottom: 1rem;
      }
    </style>
  </head>
  <body>
    <!-- Navigation-->
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
      <div class="container px-4 px-lg-5">
        <a class="navbar-brand" href="./dashboard.html">Admin Dashboard</a>
      </div>
    </nav>

    <!-- Section-->
    <section>
      <div class="container my-5">
        <div class="container-fluid h-custom">
          <div
            class="row d-flex justify-content-center align-items-center h-100"
          >
            <div class="col-md-9 col-lg-6 col-xl-5">
              <img
                src="/attachment_147202790.png"
                class="img-fluid"
                alt="Sample image"
              />
            </div>
            <div class="col-md-8 col-lg-6 col-xl-4 offset-xl-1">
              <form id="addCategory">
                <!-- Category ID -->
                <div class="col-lg-6 form-outline mb-4">
                  <select
                    name="active"
                    id="active"
                    aria-describedby="cateError"
                  >
                    <option value="">Select Category</option>
                  </select>
                </div>

                <!-- Product Name -->
                <div class="form-outline mb-4">
                  <label class="form-label" for="pro_name">Product Name</label>
                  <input
                    type="text"
                    id="pro_name"
                    name="pro_name"
                    class="form-control form-control-lg"
                    aria-describedby="nameError"
                  />
                  <div id="nameError" class="text-danger" style="display: none">
                    Product Name cannot be empty.
                  </div>
                </div>

                <!-- Product Description -->
                <div class="form-outline mb-3">
                  <label class="form-label" for="pro_description"
                    >Product Description</label
                  >
                  <input
                    type="text"
                    id="pro_description"
                    name="pro_description"
                    class="form-control form-control-lg"
                    aria-describedby="descError"
                  />
                  <div id="descError" class="text-danger" style="display: none">
                    Product Description cannot be empty.
                  </div>
                </div>

                <div class="text-center text-lg-start mt-4 pt-2">
                  <button
                    type="submit"
                    class="btn btn-primary btn-lg"
                    style="padding-left: 2.5rem; padding-right: 2.5rem"
                  >
                    Add
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Footer-->
    <footer class="py-3 bg-dark">
      <div class="container">
        <p class="m-0 text-center text-white">
          Copyright &copy; Your Website 2025
        </p>
      </div>
    </footer>

    <!-- Bootstrap core JS-->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- ADD CATEGORY -->
    <script>
      // Fetch categories when the page loads
      window.onload = function () {
        fetchCategories();
      };
    
      // Fetch categories function
      async function fetchCategories() {
        try {
          const response = await fetch("/get-category");
          const data = await response.json();
    
          const categorySelect = document.getElementById("active");
          data.data.forEach((category) => {
            const option = document.createElement("option");
            option.value = category.cate_id;
            option.textContent = category.cate_name;
            categorySelect.appendChild(option);
          });
        } catch (error) {
          console.error("Error:", error);
          alert("Error fetching categories.");
        }
      }
    
      // Handle the form submission
      document
        .getElementById("addCategory")
        .addEventListener("submit", async function (e) {
          e.preventDefault(); // Prevent default form submission
    
          // Clear previous error messages
          document.getElementById("nameError").style.display = "none";
          document.getElementById("descError").style.display = "none";
    
          // Get form data
          const productName = document.getElementById("pro_name").value;
          const productDescription = document.getElementById("pro_description").value;
          const CategoryID = document.getElementById("active").value;
    
          let valid = true;
    
          // Product Name validation
          if (!productName.trim()) {
            document.getElementById("nameError").style.display = "block";
            valid = false;
          }
    
          // Product Description validation
          if (!productDescription.trim()) {
            document.getElementById("descError").style.display = "block";
            valid = false;
          }
    
          // If valid, submit the data
          if (valid) {
            const data = {
              name: productName,
              description: productDescription,
              cate_id: CategoryID,
            };
    
            // Fetch token from localStorage
            const token = localStorage.getItem("authToken");
    
            try {
              // Perform the fetch API request
              const response = await fetch("/insert-product", {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                  Authorization: `Bearer ${token}`,
                },
                body: JSON.stringify(data),
              });
    
              const result = await response.json();
    
              if (result.status === 200) {
                alert("Product added successfully!");
                // Optionally reset form
                document.getElementById("addCategory").reset();
                document.getElementById("cateError").style.display = "none";
                document.getElementById("nameError").style.display = "none";
                document.getElementById("descError").style.display = "none";
              } else {
                alert(result.message);
                window.location.href = "./adminProduct.html";
              }
            } catch (error) {
              console.error("Error:", error);
              alert("Something went wrong, please try again.");
            }
          }
        });
    </script>
    
  </body>
</html>
